<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta charset="utf-8"/>
<title>Mapbar 地图 JavaScript API 示例</title>
<style>
body,html{ width: 100%; height: 100%;}
body{margin: 0;}
</style>
<script type="text/javascript" src="http://union.mapbar.com/apis/maps/free?f=mapi&v=31.3&k=aCW9cItqL6d6dy4iaSWtdRDpaR1hMeJ9MeV8EeFhMYV5MeJrNIGnMeMh@YeD99eW6RJVihCnMWctM9ht6IEhhiIeehiIFhee81eLMhhMR9IhiIehJMhW9hiJE99eFFl="></script>
<script type="text/javascript" src="jq1.11.js"></script>
<script type="text/javascript">
var maplet = null;
var oCamera = null;
function dragEnd(overlay) {  
    setTimeout(function() {  
        console.log("新位置经纬度：" + overlay.pt.pid);  
        //overlay.setEditable(false);  
    },500);  
} 

$(function(){
  var oDeg = $('#deg');


  maplet = new Maplet("mapbar");  
  maplet.centerAndZoom(new MPoint(116.38672,39.90805), 12);  
  maplet.addControl(new MStandardControl());  
  maplet.showOverview(false);
  MEvent.addListener(maplet, "edit", dragEnd);  

  var marker = new MMarker(  
      new MPoint(116.38749,39.90515),  
      new MIcon('<img src="camera.png" class="ico_camera">',12,38,6,32)
  );
  marker.setEditable(true);
  marker.deg = 60;
  maplet.addOverlay(marker);
  oDeg.val(marker.deg);

  oCamera = $('#OverlayBg' + marker.id)
  oCamera.css('transform','rotate('+oDeg.val()+'deg)');
  oCamera.css('transform-origin','6px 32px');
  
  $('#btn_less').on('click',function(){
    var deg = marker.deg-10;
    if(deg<0){
      deg = 360+deg;
    }
    setDeg(deg);
  })

  $('#btn_more').on('click',function(){
    var deg = marker.deg+10;
    if(deg>360){
      deg = deg-360;
    }
    setDeg(deg);
  })

  oDeg.on('change',function(){
    var deg = parseInt($(this).val())%360;
    if(isNaN(deg)){
      $(this).val(marker.deg);
      return false;
    }
    setDeg(deg);
  })

  function setDeg(deg){
    if(deg==360){
      deg=0
    };
    oCamera.css('transform','rotate('+deg+'deg)');
    marker.deg = deg;
    oDeg.val(deg);
  }


  

  
})
//transform: rotate(30deg);transform-origin: 6px 32px;transition: all 1s;
//id OverlayBg14098088050221996  OverlayBg + marker.id

</script>
</head>

<body>
<div id="mapbar" style="width:900px;height:500px"></div>
<button id="btn_less"> 左转 </button>
<input id="deg" type="text" value="0">
<button id="btn_more"> 右转 </button>
</body>
</html>
