<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<title>积分墙-首页</title>
	<meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport">
	<link rel="stylesheet" type="text/css" href="style/common.css">
	<script type="text/javascript" src="js/jquery-1.11.1.min.js"></script>
	<script type="text/javascript" src="js/common.js"></script>
</head>
<body class="bgGray">
	<div class="userBar cf">
		<p class="userBar_text">账号<a id="username" class="ml10" href="user.html"></a></p>
		<a id="logout" class="userBar_btn" href="javascript:;">退出</a>
	</div>

	<div class="balanceBar cf mt10">
		<p class="balanceBar_text">余额<span class="ml10 colorRed">￥<i id="balance">5</i>元</span></p>
		<a class="balanceBar_btn" href="withdraw.html">提现</a>
	</div>
	
	<div class="w88p bc mt25 cf">
		<p class="indexListTit colorBlue fl">有奖任务列表</p>
		<a id="refresh" class="indexListRefresh bgBlue fr" href="javascript:;">刷新 <i></i></a>
	</div>
	<ul class="indexList mt10 bgWhite">
		<li><a href="javascript:;" data-url="ad.html?id=1&url=http://www.36kr.com"><span class="span1">东风雪铁龙免费试驾，填单有奖！东风雪铁龙免费试驾，填单有奖！</span><span class="span2"><i></i>4元</span></a></li>
		<li><a href="javascript:;"><span class="span1">长安铃木试驾，限时奖励！</span><span class="span2 disabled"><i></i>完成</span></a></li>
		<!-- 
		<li><span>奇瑞QQ试驾，免费有奖！</span><a href="javascript:;"><i></i>3元</a></li>
		
		<li><span>斯巴鲁试驾，震撼登场。免费！</span><a href="javascript:;"><i></i>4元</a></li>
		<li><span>安装应用图吧导航立奖1元</span><a href="javascript:;"><i></i>1元</a></li>
		<li><span>奇瑞QQ试驾，免费有奖！</span><a href="javascript:;"><i></i>3元</a></li>
		<li><span>斯巴鲁试驾，震撼登场。免费！</span><a href="javascript:;"><i></i>4元</a></li>
		<li><span>长安铃木试驾，限时奖励！</span><a href="javascript:;"><i></i>4元</a></li> -->
	</ul>
</body>
<script>
var $refresh = $('#refresh');
var $username = $('#username');
var username = getCookie('username');
var userid = getCookie('userid');
var token = getCookie('token');

$('#username').text(username);

$('#logout').on('click',function(){
	delCookie('username');
	delCookie('token');
	delCookie('userid');
	window.location.href = 'login.html';
});
$('.indexList').on('click','a',function(){
	var url = $(this).data('url');
	if(url !== undefined){
		window.location.href = url;
	}
})

var ajaxLoading = 0;
getBalance();

function getBalance(){
	$.ajax({
		url : post.balance,
		type : 'post',
		data : {
			userid : userid,
			token : token
		},
		beforeSend : function (e){
			ajaxDisable();
		},
		success : function (data){
			ajaxEnable();

			var json = data2json(data);
			console.log(json);

			// if(json.code == 200){
			// 	addCookie('username',username,365);
			// 	addCookie('userid',json.user_id,365);
			// 	dialog({
			// 		msg:'注册成功：马上激活领取5元',
			// 		onConfirm : function(){
			// 			window.location.href = 'activate.html';
			// 		}
			// 	});
			// }else if(json.code == 1070){
			// 	dialog({msg:'注册失败：手机格式不正确'});
			// }else if(json.code == 1409){
			// 	dialog({msg:'注册失败：该账号已注册'});
			// }else{
			// 	dialog({msg:'注册失败：'+json.msg});
			// }
		},
		error : function (e){
			console.log(e);
			ajaxEnable();
		}
	});
}

function ajaxDisable(){
	ajaxLoading ++;
	$refresh.addClass('btnDisabled');
}

function ajaxEnable(){
	ajaxLoading --;
	ajaxLoading == 0 ? $refresh.removeClass('btnDisabled') : '';
}
</script>
</html>