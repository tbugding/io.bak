<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<title>积分墙-更改密码</title>
	<meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport">
	<link rel="stylesheet" type="text/css" href="style/common.css">
	<script type="text/javascript" src="js/jquery-1.11.1.min.js"></script>
	<script type="text/javascript" src="js/common.js"></script>
</head>
<body class="bgGray">
	<div class="userTopBar bgBlue"><div class="w88p bc pr"><a href="index.html"><i></i>返回首页</a></div></div>
	<div class="userPassword bgWhite">
		<input id="password" type="password" class="textInput bc" placeholder="原密码" />
		<input id="newPW" type="password" class="textInput bc mt13" placeholder="新密码" />
		<input id="newPW2" type="password" class="textInput bc mt13" placeholder="确认密码" />
		<a id="submit" class="btnNormal bgBlue mt20 bc" href="javascript:;">保存</a>
	</div>
</body>
<script>
var $password = $('#password');
var $newPW = $('#newPW');
var $newPW2 = $('#newPW2');
var $submit = $('#submit');
var ajaxLoading = false;

var token = getCookie('token');

$submit.on('click',function(){
	console.log(token)
	if(ajaxLoading){
		return;
	}
	
	var password = $password.val();
	var newPW = $newPW.val();
	var newPW2 = $newPW2.val();

	if(password == ''){
		dialog({msg:'请输入原密码'});
		return;
	}

	if(newPW == ''){
		dialog({msg:'请输入新密码'});
		return;
	}

	if(newPW.length<6 || newPW.length>20){
		dialog({msg:'密码必须大于6个字符，小于20个字符'});
		return;
	}

	if(newPW2 == ''){
		dialog({msg:'请确认新密码'});
		return;
	}

	if(newPW != newPW2){
		dialog({msg:'两次输入的密码不一致'});
		return;
	}

	$.ajax({
		url : post.password,
		type : 'post',
		data : {
			// token : token,
			password : password,
			new_password : newPW,
			confirm_new_password : newPW2
		},
		// headers: {
  //           // "token":token
  //           "User-Agent":"myAgent"
  //       },
		beforeSend : function (xhr){
			ajaxLoading = true;
			$submit.addClass('btnDisabled');

			// console.log(xhr)
			xhr.setRequestHeader("token", token);
			// xhr.setRequestHeader("aaa", "bbb");
		},
		success : function (data){
			ajaxLoading = false;
			$submit.removeClass('btnDisabled');

			var json = data2json(data);
			console.log(json);
			// if(json.code == 200){
			// 	addCookie('username',username,365);
			// 	addCookie('userid',json.user_id,365);
			// 	addCookie('token',json.token,365);
			// 	window.location.href = 'index.html';
			// }else if(json.code == 1001 || json.code == 1002){
			// 	dialog({
			// 		msg:'登录失败：用户名或者密码错误',
			// 	});
			// }else if(json.code == 1071){
			// 	addCookie('username',username,365);
			// 	addCookie('userid',json.user_id,365);
			// 	dialog({
			// 		msg:'登录失败：该账号未激活,马上激活',
			// 		onConfirm:function(){
			// 			window.location.href = 'activate.html';
			// 		}
			// 	});
			// }else{
			// 	dialog({msg:'登录失败：'+json.msg});
			// }
		},
		error : function (e){
			ajaxLoading = false;
			$submit.removeClass('btnDisabled');

			dialog({msg:'修改密码失败：\n网络故障'});
		}
	});
});
</script>
</html>