<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<title>积分墙-登录</title>
	<meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport">
	<link rel="stylesheet" type="text/css" href="style/common.css">
	<script type="text/javascript" src="js/jquery-1.11.1.min.js"></script>
	<script type="text/javascript" src="js/common.js"></script>
</head>
<body class="bgGray">
	<div class="balanceBar cf">
		<p class="balanceBar_text">余额<span class="colorRed">￥<i id="balance">5</i>元</span></p>
		<a class="balanceBar_btn" href="register.html">提现</a>
	</div>
	<div class="loginBlock0 bgWhite">
		<input id="username" type="text" class="textInput bc inputUser" placeholder="请输入账号" />
		<input id="password" type="password" class="textInput bc mt13 inputPW" placeholder="请输入密码" />
		<a id="submit" class="btnNormal bgBlue mt25 bc" href="javascript:;">登录</a>
	</div>
	<div class="loginBlock1 cf bgWhite">
		<a href="register.html">注册领<span class="colorRed">5</span>元</a>
		<a href="retrievePW.html" class="btnRight">找回密码</a>
	</div>
	<div class="loginBlock2">
		<p class="colorBlue">赚钱说明：</p>
		<ol class="mt10">
			<li>1、赚到的钱<span class="colorBlue">可以提现</span>到支付宝！</li>
			<li>2、登录可见领钱任务，最低2元起！</li>
			<li>3、每个任务<span class="colorBlue">仅需1分钟</span>，轻松搞定！</li>
			<li>4、赚钱原理：广告费直接送给用户！</li>
		</ol>
	</div>
</body>
<script>
/*存储渠道*/
var channel = oSearch.channel;
if(channel !== undefined){
	addCookie('channel',channel,365);
}

var $username = $('#username');
var $password = $('#password');
var $submit = $('#submit');

var userid = getCookie('userid');
var token = getCookie('token');
var ajaxLoading = false;

var username = getCookie('username');
if(username){
	$username.val(username);
}

$submit.on('click',function(){
	if(ajaxLoading){
		return;
	}
	
	var username = $.trim($username.val());
	var password = $password.val();

	if(username == ''){
		dialog({msg:'请输入账号'});
		return;
	}

	if(password == ''){
		dialog({msg:'请输入密码'});
		return;
	}

	$.ajax({
		url : post.login,
		type : 'post',
		data : {
			account : username,
			password : password,
			product : 'android_obd'
			// product : 'overseas_android_obd'
		},
		beforeSend : function (e){
			ajaxLoading = true;
			$submit.addClass('btnDisabled');
		},
		success : function (data){
			ajaxLoading = false;
			$submit.removeClass('btnDisabled');

			var json = data2json(data);
			console.log(json);
			if(json.code == 200){
				addCookie('username',username,365);
				addCookie('userid',json.user_id,365);
				addCookie('token',json.token,365);
				window.location.href = 'index.html';
			}else if(json.code == 1001 || json.code == 1002){
				dialog({msg:'登录失败：用户名或者密码错误'});
			}else if(json.code == 1071){
				addCookie('username',username,365);
				addCookie('userid',json.user_id,365);
				dialog({
					msg:'登录失败：该账号未激活,马上激活',
					onConfirm:function(){
						window.location.href = 'activate.html';
					}
				});
			}else{
				dialog({msg:'登录失败：'+json.msg});
			}
		},
		error : function (e){
			ajaxLoading = false;
			$submit.removeClass('btnDisabled');

			dialog({msg:'登录失败：\n网络故障'});
		}
	});
});

getBalance();
function getBalance(){
	$.ajax({
		url : post.balance,
		type : 'post',
		data : {
			userid : userid,
			token : token
		},
		success : function (data){

			var json = data2json(data);
			console.log(json);
			var username = getCookie('username');
			var channel = getCookie('channel');
			if(json.code == 200 && username && channel){
				window.location.href = 'index.html';
			}
		}
	});
}
</script>
</html>