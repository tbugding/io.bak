---
layout: post
title: 百度地图急速版开发
category : webApp
tagline: 
tags : [百度地图, 移动端开发]
---


{% include JB/setup %}
<!--break-->

**先说一下开发过程中遇到的问题**

大众版是有定位控件的，但是急速版没有，很多API根本没开放，坑爹。
没办法，只能自己开发了。

		var gectrl=new BMap.GeolocationControl(); 
		map.addControl(gectrl);

*手机端图片没有百度地图web版清晰 highResolutionEnabled()无效？

*手机端单击|双击|触摸事件（click|dblclick|touch）无效？

**下面是百度地图急速版API学习笔记**

## 初始化地图

**创建地图实例**
		var map = new BMap.Map("l-map");

**创建点坐标**
		var point = new BMap.Point(116.404, 39.915);

**地图初始化（参数：坐标点，缩放级别1-18）**
		map.centerAndZoom(point, 14);

**移动地图方法**
		map.enableDragging();  //可拖拽，默认开启
		map.setCenter(new BMap.Point(116.409, 39.918));    	//中心点跳转到
		map.panTo(new BMap.Point(116.409, 39.918));			//中心点移动到


## 地图控件

**添加|删除控件**
addControl | removeControl

**控件**
		new BMap.ZoomControl();		//缩放控件
		new BMap.ScaleControl()		//比例尺控件

**添加缩放控件**
		var zoomControl=new BMap.ZoomControl();  
		map.addControl(zoomControl);

**删除缩放控件**
		map.removeControl(zoomControl);

**控件位置**
		var opts = {anchor: BMAP_ANCHOR_BOTTOM_LEFT ,offset:new BMap.Size(0,0)}
		var ScaleControl=new BMap.ScaleControl(opts);
		map.addControl(ScaleControl);
anchor:在屏幕的那个角
- BMAP_ANCHOR_TOP_LEFT
- BMAP_ANCHOR_TOP_RIGHT
- BMAP_ANCHOR_BOTTOM_LEFT
- BMAP_ANCHOR_BOTTOM_RIGHT
offset:相对于角的偏移量
anchor和offset可以单独使用，也可以结合使用

**自定义控件**
- 定义一个自定义控件的构造函数。
- 提供defaultAnchor和defaultOffset属性。
- 设置自定义控件构造函数的prototype属性为Control的实例，以便继承控件基类。
- 实现initialize(),并且将控件的DOM元素返回。
	map.addControl()方法添加自定义控件时，API会调用该对象的initialize()方法用来初始化控件。
		function MyControl(){
			this.defaultAnchor = BMAP_ANCHOR_TOP_LEFT;      
			this.defaultOffset = new BMap.Size(10, 10);
		}

		MyControl.prototype = new BMap.Control();

		MyControl.prototype.initialize = function(map){      
			var div = document.createElement("div");      
			div.appendChild(document.createTextNode("放大2级"));      
			div.style.cursor = "pointer";      
			div.style.border = "1px solid gray";      
			div.style.backgroundColor = "white";   

			div.onclick = function(e){    
			        map.setZoom(map.getZoom() + 2);      
			}

			map.getContainer().appendChild(div);    
			return div;    
		}

		map.addControl(new MyControl()); 


## 地图覆盖物

**覆盖物类型**
- Overlay：覆盖物的抽象基类，所有的覆盖物均继承此类的方法。
- Marker：标注表示地图上的点，可自定义标注的图标。
- Polyline：表示地图上的折线。
- InfoWindow：信息窗口也是一种特殊的覆盖物，它可以展示更为丰富的文字和多媒体信息。注意：同一时刻只能有一个信息窗口在地图上打开。

**添加和移除覆盖物**
		map.addOverlay
		map.removeOverlay
此方法不适用于InfoWindow。

**标注**
		var marker = new BMap.Marker(new BMap.Point(116.404, 39.915));
		map.addOverlay(marker);

**自定义标注图标**
		var map = new BMap.Map("l-map");      
		var point = new BMap.Point(116.404, 39.915);      
		map.centerAndZoom(point, 15);  // 编写自定义函数，创建标注     
		function addMarker(point, index){  // 创建图标对象     
			var myIcon = new BMap.Icon("http://api.map.baidu.com/mapCard/img/location.gif",   
				new BMap.Size(14, 23), {      
				// 指定定位位置。     
				// 当标注显示在地图上时，其所指向的地理位置距离图标左上      
				// 角各偏移7像素和25像素。您可以看到在本例中该位置即是     
				// 图标中央下端的尖角位置。      
				anchor: new BMap.Size(7, 25),        
			});        
			// 创建标注对象并添加到地图     
			var marker = new BMap.Marker(point, {icon: myIcon});      
			map.addOverlay(marker);     
				marker.addEventListener("click", function(){      
				alert("您点击了标注");      
			}); 
		}   

		// 随机向地图添加10个标注      
		var bounds = map.getBounds();      
		var lngSpan = bounds.getNorthEast().lng - bounds.getSouthWest().lng;      
		var latSpan = bounds.getNorthEast().lat- bounds.getSouthWest().lat;      
		for (var i = 0; i < 10; i++) {  
			var point = new BMap.Point(bounds.getSouthWest().lng + lngSpan * (Math.random() * 0.7 + 0.15), bounds.getSouthWest().lat + latSpan * (Math.random() * 0.7 + 0.15));  
			addMarker(point, i); 
		}

**信息窗口**
		var marker = new BMap.Marker(new BMap.Point(116.404, 39.915));
		var opts = {      
		    width : 100,     // 信息窗口宽度      
		    height: 50,     // 信息窗口高度      
		    title : "Hello"  // 信息窗口标题     
		}      
		var infoWindow = new BMap.InfoWindow("World", opts);  // 创建信息窗口对象      
		map.openInfoWindow(infoWindow, marker.getPosition());      // 打开信息窗口

**折线**
	var polyline = new BMap.Polyline(
			[new BMap.Point(116.399, 39.910),      
			new BMap.Point(116.405, 39.920)],      
			{strokeColor:"blue", strokeWeight:6, strokeOpacity:0.5}
		);
	map.addOverlay(polyline);

**自定义覆盖物**
	略


## 事件

		map.addEventListener("moveend", function(){      
			var center = map.getCenter();      
			console.log("地图中心点变更为：" + center.lng + ", " + center.lat);      
		});

**事件参数**
		map.addEventListener("click", function(e){      
			alert(e.point.lng + ", " + e.point.lat);      
		});

**事件里的this**
		map.addEventListener("zoomend", function(){      
			alert("地图缩放至：" + this.getZoom() + "级");      
		});

**移除监听事件**
		function showInfo(e){      
		   alert(e.point.lng + ", " + e.point.lat);      
		   map.removeEventListener("click", showInfo);      
		}      
		map.addEventListener("click", showInfo);


## 地图图层

**添加和删除交通图层**
		var traffic = new BMap.TrafficLayer();
		map.addTileLayer(traffic);
		map.removeTileLayer(traffic);

**自定义图层**
	略


## 地图服务

- LocalSearch：本地搜索，提供某一特定地区的位置搜索服务，比如在北京市搜索“公园”。
- Geocoder：地址解析，提供将地址信息转换为坐标点信息的服务。
- routeSearch：线路规划、导航服务，调用该服务可跳转到百度地图webapp页面进行公交、驾车、步行、导航等操作。

**本地搜索**

eg1:基本
		var local = new BMap.LocalSearch(map, {      
		      renderOptions:{map: map}      
		});      
		local.search("天安门");

eg2:配置搜索
		var local = new BMap.LocalSearch(
				"北京市",   
				{renderOptions: {map: map,autoViewport: true},
				pageCapacity: 8}
			);      
		local.search("中关村");

eg3:结果面板
		var local = new BMap.LocalSearch(map,{renderOptions: {map: map,panel: "results"}});
		local.search("中关村");

eg4:数据接口
		var options = {      
		      onSearchComplete: function(results){      
		          if (local.getStatus() == BMAP_STATUS_SUCCESS){      
		                // 判断状态是否正确      
		                var s = [];      
		                for (var i = 0; i < results.getCurrentNumPois(); i ++){      
		                    s.push(results.getPoi(i).title + ", " + results.getPoi(i).address);      
		                }      
		             document.getElementById("log").innerHTML = s.join("<br>");      
		          }      
		      }      
		 };      
		var local = new BMap.LocalSearch(map, options);      
		local.search("公园");

**周边搜索**
	var local = new BMap.LocalSearch(map,   
			{ renderOptions:{map: map, autoViewport: true}});      
	local.searchNearby("小吃", "前门");

**矩形范围搜索**
		var local = new BMap.LocalSearch(map,   
				{ renderOptions:{map: map}});      
		local.searchInBounds("银行", map.getBounds());

**线路规划|导航**
- [百度地图web版的实现](http://map.baidu.com/mobile/webapp/index/index)
		var routeSearch=new BMap.RouteSearch();  
		var start = {  
		      latlng:new BMap.Point(116.404, 39.915),  
		      name:"故宫"  
		  }  
		var end = {  
		     latlng:new BMap.Point(116.380825,39.915455),  
		     name:"肯德基（汉光店）"  
		  }  
		var opts = {  
		     mode:BMAP_MODE_DRIVING,//公交、驾车、导航均修改该参数  
		     region:"北京"  
		  }  
		var ss = new BMap.RouteSearch();  
		routeSearch.routeCall(start,end,opts);

**地理编码**
		//创建地址解析器实例     
		var myGeo = new BMap.Geocoder();

		//将地址解析结果显示在地图上，并调整地图视野
		myGeo.getPoint("北京市海淀区上地10街10号", function(point){
			if (point) {
				map.centerAndZoom(point, 16);
				map.addOverlay(new BMap.Marker(point));
			}
		}, "北京市");

		//根据地址描述获得坐标

**反向地理编码**
		//创建地理编码实例      
		var myGeo = new BMap.Geocoder();   
		   
		// 根据坐标得到地址描述    
		myGeo.getLocation(new BMap.Point(116.364, 39.993), function(result){
			if (result){
				alert(result.address);
			}
		});


